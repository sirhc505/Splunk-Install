#This unit file replaces the traditional start-up script for systemd
#configurations, and is used when enabling boot-start for Splunk on
#systemd-based Linux distributions.

[Unit]
Description=Systemd service file for Splunk, generated by 'splunk enable boot-start'
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
Restart=always
ExecStart=/opt/splunk/bin/splunk _internal_launch_under_systemd
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=360
LimitNOFILE=65536
LimitRTPRIO=99
SuccessExitStatus=51 52
RestartPreventExitStatus=51
RestartForceExitStatus=52
User=splunk
Group=splunk
NoNewPrivileges=yes
AmbientCapabilities=CAP_DAC_READ_SEARCH
ExecStartPre=-/bin/bash -c \"chown -R splunk:splunk /opt/splunk\"
Delegate=true
MemoryMax={{ SERVICE_MEMORY }}
CPUWeight={{ CPU_WEIGHT }}
User=splunk

PermissionsStartOnly=true
ExecStartPost=-/bin/bash -c \"chown -R splunk:splunk /sys/fs/cgroup/cpu/system.slice/%n\"
ExecStartPost=-/bin/bash -c \"chown -R splunk:splunk /sys/fs/cgroup/memory/system.slice/%n\"

[Install]
WantedBy=multi-user.target